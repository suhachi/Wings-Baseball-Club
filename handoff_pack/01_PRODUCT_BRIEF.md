# handoff_pack/01_PRODUCT_BRIEF.md

## 목적/범위
제품의 목적, 사용자, 성공 기준, 역할 정의, 승인제 상태 모델을 명확히 정의합니다.

---

## 제품 목적

**WINGS BASEBALL CLUB**은 야구동호회 커뮤니티 운영 및 경기 기록을 통합 관리하는 PWA(Progressive Web App)입니다.

### 핵심 가치
- **커뮤니티 통합 관리**: 공지, 일정, 게시판, 앨범, 회계를 하나의 플랫폼에서 관리
- **경기 기록 전문화**: 라인업, 타자/투수 기록, 기록 잠금(LOCK) 기능
- **관리자 직접 승인 시스템**: Google OAuth 로그인 전용 (초대/회원가입/자동승인 없음)

---

## 사용자

### 주요 사용자
1. **회원** (MEMBER): 일반 동호회 회원 (관리자 승인 후 접근 가능)
   - 공지사항 확인, 일정 참여, 출석 투표, 게시판 사용
   
2. **관리자** (ADMIN): 게시글 관리, 유저 승인 및 역할 부여 (PRESIDENT, DIRECTOR 보조)
   
3. **총무** (TREASURER): 회비/회계 관리
   
4. **감독** (DIRECTOR): 경기 기록 관리 + 관리자 권한
   
5. **회장** (PRESIDENT): 모든 권한

---

## 성공 기준

### 1. 공지 푸시 알림 ✅ 구현 완료
- **목표**: 공지사항(`type: 'notice'`) 작성 시 모든 활성 회원(`status: 'active'`)에게 푸시 알림 발송
- **기능**: 발송 여부 및 발송 상태(SUCCESS/FAILED)를 상세 모달에서 배지로 확인 가능 (관리자 전용)
- **위치**: `functions/src/notices.ts` (전송 로직), `PostDetailModal.tsx` (상태 표시)

### 2. 출석 투표 마감 ⚠️ 미구현
- **목표**: 일정(`type: 'event'`)의 출석 투표가 **전날 23:00**에 자동 마감
- **로직**: 
  - 게시글 작성 시 `voteCloseAt = startAt - 1일 23:00` 계산하여 저장
  - Cloud Functions 스케줄러로 `voteClosed: true` 업데이트 구현 필요
- **현재 상태**: 클라이언트에서 마간 시간 계산만 수행, 자동 처리 로직 미비

### 3. 경기 기록 권한/LOCK ✅ 구현됨
- **목표**: 
  - 관리자 또는 지정된 기록원(`post.recorders`)만 경기 기록 작성 가능
  - LOCK 후에는 기록원은 수정 불가, 관리자는 수정 가능
- **상세**: `handoff_pack/09_WF07_GAME_RECORDING_IMPLEMENTATION.md` 참조

---

## 역할 정의 (RBAC)

### 역할 (UserRole)
정의 위치: `src/lib/firebase/types.ts`

```typescript
export type UserRole = 'PRESIDENT' | 'DIRECTOR' | 'TREASURER' | 'ADMIN' | 'MEMBER';
```

| 역할 | 코드 | 권한 요약 |
|------|------|------|
| 회장 | `PRESIDENT` | 모든 권한 (권한 부여, 게시글/경기/회계 총괄) |
| 감독 | `DIRECTOR` | 관리 권한 + 경기 기록 관리 전문화 |
| 총무 | `TREASURER` | 회비/회계 관리 (`FinancePage`) |
| 관리자 | `ADMIN` | 게시글/회원 상태 관리 (초대 코드 기능은 삭제됨) |
| 일반회원 | `MEMBER` | 게시글 작성, 출석 투표, 댓글 등 기본 커뮤니티 활동 |

---

## 승인제 상태 모델 (Access Gate)

### 상태 정의 (Status)
Google 로그인 직후 모든 사용자는 `pending` 상태로 자동 생성됩니다.

| 상태 | 의미 | 접근 권한 |
|------|------|---------|
| `pending` | 승인 대기 | **Access Denied** (차단 페이지 노출) |
| `active` | 활성 회원 | **Full Access** (정상 사용) |
| `rejected` | 가입 거절 | **Access Denied** (차단 페이지 노출) |
| `withdrawn` | 탈퇴 회원 | **Access Denied** (차단 페이지 노출) |

### 회원 관리 정책
1. **신규 진입**: 사용자는 Google 계정으로만 로그인할 수 있습니다.
2. **최초 상태**: 최초 로그인 시 서버(Cloud Functions) 또는 클라이언트에서 `status: 'pending'` 문서를 자동 생성합니다. (회원가입 폼 없음)
3. **권한 부여**: 관리자(ADMIN 이상)가 `AdminPage`에서 사용자를 확인하고 `status: 'active'`로 변경한 시점부터 앱 사용이 가능합니다.
4. **초대 코드 중단**: 보안 및 관리 효율을 위해 모든 초대 코드(Invite Code) 기반 가입은 폐지되었습니다.

---

## 기능별 권한 매트릭스

| 기능 | MEMBER | ADMIN | TREASURER | DIRECTOR | PRESIDENT |
|------|--------|-------|-----------|----------|-----------|
| 게시글 작성 | ✅ | ✅ | ✅ | ✅ | ✅ |
| 게시글 삭제 (본인) | ✅ | ✅ | ✅ | ✅ | ✅ |
| 게시글 삭제 (타인) | ❌ | ✅ | ❌ | ✅ | ✅ |
| 공지사항 작성 (푸시) | ❌ | ✅ | ❌ | ✅ | ✅ |
| 회원 상태 변경 (승인) | ❌ | ✅ | ❌ | ✅ | ✅ |
| 역할 변경 (Role) | ❌ | ❌ | ❌ | ❌ | ✅ |
| 경기 기록 작성 | ❌ | ❌ | ❌ | ✅ | ✅ |
| 경기 기록 LOCK | ❌ | ❌ | ❌ | ✅ | ✅ |
| 회계 관리 | ❌ | ❌ | ✅ | ❌ | ✅ |
| **초대 코드 생성** | ❌ | ❌ | ❌ | ❌ | ❌ (삭제됨) |

---

## 향후 대책 (TODO)

1. **승인 알림**: 관리자가 승인(Active) 처리 시 해당 사용자에게 푸시/메일 알림 (옵션)
2. **회계 승인 자동화**: 회비 납부 확인 시 잔액 자동 합산 로직
3. **출석 자동 마감**: Cloud Functions 스케줄러 안정화
